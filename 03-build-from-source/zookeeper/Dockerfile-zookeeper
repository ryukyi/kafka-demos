# Use Alpine Linux with OpenJDK
FROM alpine:3.16

# Install Java and essential tools
RUN apk add --no-cache openjdk11-jre-headless bash curl tar

# Set environment variables for ZooKeeper
ENV ZOOKEEPER_VERSION=3.8.4 \
    ZOOKEEPER_HOME=/opt/zookeeper

# Download and install ZooKeeper
RUN mkdir -p "$ZOOKEEPER_HOME" \
    && curl -fSL "https://downloads.apache.org/zookeeper/zookeeper-$ZOOKEEPER_VERSION/apache-zookeeper-$ZOOKEEPER_VERSION-bin.tar.gz" -o /tmp/zookeeper.tgz \
    && tar -xzf /tmp/zookeeper.tgz -C "$ZOOKEEPER_HOME" --strip-components=1 \
    && rm /tmp/zookeeper.tgz

# Add a user and change ownership of the ZooKeeper directory
RUN addgroup -S zookeeper && adduser -S -G zookeeper zookeeper \
    && chown -R zookeeper:zookeeper "$ZOOKEEPER_HOME"

# Set the working directory to the ZooKeeper home
WORKDIR $ZOOKEEPER_HOME

# Expose ZooKeeper client port
EXPOSE 2181

# Run ZooKeeper as the non-root user "zookeeper"
USER zookeeper

# Default command to run ZooKeeper
CMD ["bin/zkServer.sh", "start-foreground"]

